<!DOCTYPE html>
<html>
<head>
  <title>Ultimate Asteroid Simulator ðŸŒŽðŸš€</title>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <style>
    body{margin:0;font-family:Arial;background:#0b0b1a;color:#fff;}
    header{text-align:center;padding:20px;font-size:24px;}
    #controls{display:flex;justify-content:center;gap:20px;margin-bottom:10px;flex-wrap:wrap;}
    .control-group{display:flex;flex-direction:column;align-items:center;}
    #asteroidList{display:flex;flex-wrap:wrap;justify-content:center;max-height:220px;overflow-y:auto;margin:10px;}
    .card{background:#1a1a2e;margin:5px;padding:10px;border-radius:10px;width:200px;cursor:pointer;transition:transform 0.2s;}
    .card:hover{transform:scale(1.05);}
    #output{text-align:center;font-size:18px;margin-top:10px;}
    #map{height:600px;margin:20px;border-radius:10px;}
    .pulse{animation:pulse 1s infinite alternate;}
    @keyframes pulse{0%{opacity:0.5;}100%{opacity:1;}}
    #layersToggle{position:absolute;top:80px;right:20px;background:#1a1a2e;padding:10px;border-radius:10px;z-index:1000;}
    #layersToggle input{margin-right:5px;}
  </style>
</head>
<body>
  <header>Ultimate Asteroid Simulator ðŸŒŽðŸš€</header>

  <div id="controls">
    <div class="control-group">
      <label>Diameter (m)</label>
      <input type="range" id="diameterSlider" min="1" max="5000" value="50">
      <span id="diameterValue">50</span>
    </div>
    <div class="control-group">
      <label>Velocity (m/s)</label>
      <input type="range" id="velocitySlider" min="1000" max="100000" value="20000">
      <span id="velocityValue">20000</span>
    </div>
    <div class="control-group">
      <label>Deflection Angle (Â°)</label>
      <input type="range" id="deflectSlider" min="-45" max="45" value="0">
      <span id="deflectValue">0</span>
    </div>
  </div>

  <div id="asteroidList"></div>
  <div id="output">Pick an asteroid or click anywhere on the map to simulate!</div>

  <div id="layersToggle">
    <label><input type="checkbox" id="topoLayer" checked> Topography</label><br>
    <label><input type="checkbox" id="tsunamiLayer" checked> Tsunami Zones</label><br>
    <label><input type="checkbox" id="popLayer" checked> Population Density</label>
  </div>

  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    const map=L.map('map').setView([20,0],2);

    // Base map
    const base=L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

    // Topography
    const topo=L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png');

    // Dummy tsunami GeoJSON (replace with USGS for full version)
    const tsunamiLayer=L.geoJSON(null,{style:{color:'#00ffff',fillOpacity:0.3}});
    fetch('https://raw.githubusercontent.com/ginseng666/sample-data/main/tsunami.geojson')
      .then(r=>r.json()).then(data=>tsunamiLayer.addData(data).addTo(map));

    // Dummy population GeoJSON (replace with NASA SEDAC for full version)
    const popLayer=L.geoJSON(null,{style:{color:'#ff8800',fillOpacity:0.2}});
    fetch('https://raw.githubusercontent.com/ginseng666/sample-data/main/population.geojson')
      .then(r=>r.json()).then(data=>popLayer.addData(data).addTo(map));

    document.getElementById('topoLayer').onchange=function(){this.checked?topo.addTo(map):map.removeLayer(topo);}
    document.getElementById('tsunamiLayer').onchange=function(){this.checked?tsunamiLayer.addTo(map):map.removeLayer(tsunamiLayer);}
    document.getElementById('popLayer').onchange=function(){this.checked?popLayer.addTo(map):map.removeLayer(popLayer);}

    const asteroids=[
      {name:"Chelyabinsk Meteor",diameter:20,velocity:19000,lat:55.15,lng:61.41,funFact:"Airburst over Russia injured ~1500 people."},
      {name:"Tunguska Event",diameter:50,velocity:15000,lat:60.89,lng:101.90,funFact:"Flattened 2,000 kmÂ² of Siberian forest."},
      {name:"Meteor Crater (Arizona)",diameter:50,velocity:20000,lat:35.03,lng:-111.02,funFact:"Created huge crater in Arizona."},
      {name:"Sikhote-Alin Meteorite",diameter:10,velocity:15000,lat:46.15,lng:134.1,funFact:"Iron meteorite fell in Russia."},
      {name:"Hoba Meteorite",diameter:10,velocity:12000,lat:-19.58,lng:17.92,funFact:"Largest intact meteorite."},
      {name:"Apophis (99942)",diameter:370,velocity:30000,lat:-10,lng:60,funFact:"Famous near-Earth asteroid, low impact probability."},
      {name:"Bennu (1999 RQ36)",diameter:500,velocity:28000,lat:15,lng:-20,funFact:"Target of NASA OSIRIS-REx mission."},
      {name:"Ryugu",diameter:900,velocity:25000,lat:10,lng:-35,funFact:"Asteroid sampled by Hayabusa2 mission."},
      {name:"Florence (3122)",diameter:4500,velocity:35000,lat:5,lng:5,funFact:"Large near-Earth asteroid passed Earth in 2017."},
      {name:"2012 DA14",diameter:30,velocity:17000,lat:1,lng:15,funFact:"Famous flyby near Earth."},
      {name:"Chariklo",diameter:250,velocity:20000,lat:20,lng:-25,funFact:"Centaur object with rings."},
      {name:"Itokawa",diameter:535,velocity:22000,lat:-15,lng:35,funFact:"Target of Japanese Hayabusa mission."},
      {name:"Ceres",diameter:940000,velocity:17000,lat:-20,lng:20,funFact:"Dwarf planet, largest object in asteroid belt."},
      {name:"Vesta",diameter:525000,velocity:17000,lat:0,lng:0,funFact:"One of the largest asteroids in asteroid belt."},
      {name:"2019 OK",diameter:100,velocity:25000,lat:0,lng:25,funFact:"Close pass to Earth in 2019."},
      {name:"2008 TC3",diameter:4,velocity:12500,lat:9,lng:12,funFact:"First asteroid detected before impact."},
      {name:"2014 AA",diameter:2,velocity:12000,lat:-5,lng:-10,funFact:"Small impact over Atlantic, first observed from space."},
      {name:"Aten (2004)",diameter:35,velocity:15000,lat:10,lng:30,funFact:"Near-Earth asteroid, Aten class."},
      {name:"Gustav (1908)",diameter:30,velocity:18000,lat:50,lng:-80,funFact:"Small asteroid, historical studies."},
      {name:"Impactor-2025",diameter:50,velocity:20000,lat:0,lng:0,funFact:"Hypothetical NASA challenge asteroid."},
      {name:"Pallas",diameter:512000,velocity:18000,lat:5,lng:-40,funFact:"Second largest asteroid in asteroid belt."},
      {name:"Hygiea",diameter:430000,velocity:16000,lat:-10,lng:50,funFact:"Dark asteroid in outer belt."},
      {name:"2001 FO32",diameter:1000,velocity:78000,lat:10,lng:-5,funFact:"Fast-moving near-Earth asteroid."},
      {name:"Toutatis",diameter:5000,velocity:15000,lat:35,lng:120,funFact:"Famous for chaotic orbit."},
      {name:"Gaspra",diameter:12000,velocity:14000,lat:30,lng:30,funFact:"First asteroid imaged by spacecraft."},
      {name:"Eros",diameter:17000,velocity:12000,lat:25,lng:-25,funFact:"Visited by NEAR Shoemaker spacecraft."},
      {name:"Ida",diameter:15000,velocity:13000,lat:-15,lng:60,funFact:"Asteroid with moon Dactyl."},
      {name:"Dactyl",diameter:1.4,velocity:13000,lat:-15,lng:60,funFact:"Moon of asteroid Ida."},
      {name:"Mathilde",diameter:50000,velocity:12000,lat:5,lng:15,funFact:"C-type asteroid visited by NEAR Shoemaker."}
    ];

    const asteroidListDiv=document.getElementById('asteroidList');
    asteroids.forEach(a=>{
      const card=document.createElement('div');
      card.className='card';
      card.innerHTML=`<b>${a.name}</b><br>Diameter: ${a.diameter} m<br>Velocity: ${a.velocity} m/s<br><i>${a.funFact}</i>`;
      card.onclick=()=>simulateImpact(a.lat,a.lng,a);
      asteroidListDiv.appendChild(card);
    });

    const diameterSlider=document.getElementById('diameterSlider');
    const velocitySlider=document.getElementById('velocitySlider');
    const deflectSlider=document.getElementById('deflectSlider');
    const diameterValue=document.getElementById('diameterValue');
    const velocityValue=document.getElementById('velocityValue');
    const deflectValue=document.getElementById('deflectValue');
    diameterSlider.oninput=()=>{diameterValue.textContent=diameterSlider.value;};
    velocitySlider.oninput=()=>{velocityValue.textContent=velocitySlider.value;};
    deflectSlider.oninput=()=>{deflectValue.textContent=deflectSlider.value;};

    let orbitMarker, impactCircle, shockwaves=[];
    function estimatePopulation(lat,lng,radius){ return Math.floor(radius*200); }

    map.on('click', function(e){simulateImpact(e.latlng.lat,e.latlng.lng,null);});

    function simulateImpact(lat,lng,asteroid){
      if(impactCircle) map.removeLayer(impactCircle);
      if(orbitMarker) map.removeLayer(orbitMarker);
      shockwaves.forEach(s=>map.removeLayer(s)); shockwaves=[];

      let diameter=diameterSlider.value;
      let velocity=velocitySlider.value;
      if(asteroid){
        diameter=asteroid.diameter;
        velocity=asteroid.velocity;
        diameterSlider.value=diameter;
        velocitySlider.value=velocity;
        diameterValue.textContent=diameter;
        velocityValue.textContent=velocity;
      }
      const deflection=deflectSlider.value;

      const mass=(4/3)*Math.PI*(diameter/2)**3*3000;
      const energy=0.5*mass*velocity**2;
      const crater=1.161*(energy**(1/3.4));
      const popAffected=estimatePopulation(lat,lng,crater/1000);

      document.getElementById('output').innerHTML=
        `<b>Asteroid Impact Simulation</b><br>${asteroid?'<b>'+asteroid.name+'</b><br>':''}
        Energy: ${energy.toExponential(2)} J<br>
        Estimated Crater Diameter: ${crater.toFixed(0)} m<br>
        Estimated Population Affected: ${popAffected}<br>
        Fun Fact: ${asteroid?asteroid.funFact:'User-selected location.'}`;

      const startLat=lat+20, startLng=lng-20, controlLat=lat+10, controlLng=lng+10;
      let progress=0, steps=100;
      orbitMarker=L.circleMarker([startLat,startLng],{radius:6,color:'#ffd700',fillOpacity:1}).addTo(map);

      const interval=setInterval(()=>{
        progress++;
        const t=progress/steps;
        const curLat=(1-t)**2*startLat + 2*(1-t)*t*controlLat + t**2*lat;
        const curLng=(1-t)**2*startLng + 2*(1-t)*t*controlLng + t**2*(lng + deflection/5);
        orbitMarker.setLatLng([curLat,curLng]);

        if(progress>=steps){
          clearInterval(interval);
          orbitMarker.remove();
          if(Math.abs(deflection)<40){
            impactCircle=L.circle([lat,lng],{color:'red', fillColor:'#ff4444', fillOpacity:0.5, radius:crater/2}).addTo(map);
            impactCircle.getElement()?.classList.add('pulse');

            let swRadius=crater/2;
            const swInterval=setInterval(()=>{
              swRadius+=1000;
              const sw=L.circle([lat,lng],{color:'#ff8800',fill:false,radius:swRadius,opacity:0.4}).addTo(map);
              shockwaves.push(sw);
              if(swRadius>crater*10){shockwaves.forEach(s=>map.removeLayer(s));shockwaves=[];clearInterval(swInterval);}
            },50);
          } else{ document.getElementById('output').innerHTML+=`<br><b>Asteroid Missed Earth!</b>`; }
        }
      },20);
      map.setView([lat,lng],5);
    }
  </script>
</body>
</html>
